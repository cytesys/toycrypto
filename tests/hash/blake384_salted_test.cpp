#include <gtest/gtest.h>

#include <toycrypto/hash/blake.h>

class Blake384SaltedTests : public ::testing::Test {
protected:
    void SetUp() override {
        m_hfun.reset();
        m_hfun.add_salt(m_salt.c_str(), m_salt.length());
    }

    BLAKE384 m_hfun{};

    std::string m_salt = "toomuchsaltwillkillya";

    const std::string m_empty_digest =
        "99e873785ca22f6359d9980fdb3d02ebd9d20f41f6a25a433a0c0ebb33da61b70793c3b05f219bf5b8f6e94f9bcd188c";

    const std::string m_fox_digest =
        "f9bcbb5b2d4c748782609686abe2b73181cb00fff4f0fb24cdc42f79c11519fc8448b39c2c30ca0ce37cba633196d4f9";

    const std::array<std::string, 134> m_cmp = {
        "99e873785ca22f6359d9980fdb3d02ebd9d20f41f6a25a433a0c0ebb33da61b70793c3b05f219bf5b8f6e94f9bcd188c",
        "62a61284b4f339b7dfcb8dca4cfcf165d296038e9e53a2fde9c1584f830dfa1dd674258f4aa41cd6f12a7023342a5934",
        "ec08e387339348f7bd7d4f937e6833368d34e5fceefb458f3fbfcb05b2e6f8bddf9bfb9ea6b9ae09b093d0a88a1143e3",
        "adf709ce5d28d4c4bacb53c662e609c50e1b1b3821d658e6faeed4bf45567b940aa8e5b150ba0ec85642559dbb036b1b",
        "088fbffd97d1839ea7f50e9b14216d5c3ceb3e498bf7521b7ffaa88d9ecc3839d254e538832df06b1c0fefeb041b0af2",
        "2f4f05985279ecfb582634cd472075321ae2dd5fbe24e04edc522a26b3bed3e33762153de0f6b202e106518e84a025fc",
        "e05d2d781323c66aeed96291fa853f371d4c5852467d3ed61dbd481558a53c5425f07348a71995e0204893281fc22fbc",
        "508865013468641353eedc871ff356765d1c42c3ff111e5555e862771a51af0869c88479b719b67df47d8f68ab359a95",
        "f875f749aaf4556a5876a6add80c0744817046ac153459c7e2de3a7924253d73d8a54bfdbebf05eb44a4ab382f558046",
        "09eaf7f1f8058888403f997298b168c527c19bd3b5bc67ad90533f53510816ed953ff366c595a60c143d7b0592062d1a",
        "f8c2f0dd084339fd2200c7f486ae180550004c79599ac58876d6bfad13134314c6d9dfd93f35666f5866f014f768f1ce",
        "3054cde9eb656469a4d5f990dcd1a9d81f81611fb7c9e20c90d0c7931988bdd9dbde2139898e2790513c46f6fd9870a6",
        "012ec9cfd846c6b4168ba3bf9cdcacc57e226718c959d882dfaf8e6fbae103a265efdf00292fa2f31c6c365d5f649337",
        "a3d9367e4d064a506a2a4118049ad4a3c5a5091ded3da916a293a9448845b5239a331c497e1b7c07520148d22fc31ead",
        "42db6d848532cbfcdbf1b10ccc55a2dea59702965fcd308731bf187848c98ce71c744251de5e87185445bae80bf7a64d",
        "37445ff64540102a9570cc14c9c563c8a1db456b55677406f2925b54ed9f21886f9e7e3f5e20f94b659e8fd2335faaeb",
        "33963bc93cd818557efeaf02955a5acd4fcf050d2de80150a83e3164ff69370f7b2f52f48bb1acac16d3ffe3be39de2b",
        "f5b3781bc4783ad53a6a191f56609f4c36b27955dcc00d40556dee3539d160c6e8f83aa191ce65da35425a200fc49764",
        "26381772bf6045cc0a76f29a9890362c76bb309727eb6123f4610e5a06168bb7c65e21a17d05f4bea65e6ffade43ce8f",
        "918b5a2d984b2e43fe2c2c25e420492b2c3516c1bcc6d04e908d61d90a15679fcc47c2b32f0b43b20ae97c2be88f1927",
        "7b5992bda6903e29bffb421608e1fedba21c400d1525fa0547b154341cf48b292667ccebedf339ee2346359e959a1244",
        "dd71156e029f636b5180f4d1fb06546b741c429674bc6d5eb18b526faf339dd62088a502d180721e0c59f78913d9ddc4",
        "6767b3f90d02a3058b1ad443a3bc0ff3d116f68a648bb49e8283e3ecaca748d97d5d100c0a9a725585a10a0e86a2b58e",
        "5616738b33623713549f5bee2e816564c070d4e0d6a6699eb9ed000f061d0df7fbe8a50d9c31ede42d0afd3656db8274",
        "afb360857289fed778316fbb46c4c867457ec7cfea1d555a2625c3497c04775dc0c4197faa20186fdb301ab6b607ac34",
        "fa4f67cd09732a0348c80e870711db478f9a61319f748fac6d3b2b554e4ebab3df725a7534a4f039aed1097254bc2990",
        "1d625593c48986649e65392f438e71b999e402bdd5675af6256a9784548697763436038f33a7f70a3cbb771dffc1fa7e",
        "2a1b0ebaa64c3d30dbe4754ec3b6af80fda90350773b3794740f5fdac3b6d8a3a085a47598b1c1f93570e9ccaa7f361a",
        "12fbfc8a78208ee60ed104875f6cf161e254af2edd4335b26c56e32947583d2dd8fbac9aa6c2a890867278f4021ed956",
        "5fc6e16aed47d63a4b8024926055389a32890da4936b52f75e146db00e1c2f84bc375df59671b72c382ce1b58121d155",
        "db5d32c5c101ff3cde84d22548d5477ed6e5ec71dcb317a1c2bf3b222b8d9274ec2c7adf7bc0aca9946de9f0577a6e0b",
        "773b05a4060980c21dfa8f30388e1ec0c9ba7a9187e229eebc05f8d3fa7ef896b5176499f4fa18e317170a4d0efb9b9a",
        "3df4f3a270c5b0b6d02587294339ad0b8afe4e5e4a38cf1b63304314fadad38192e46928744b64545c4adf9939c354eb",
        "fb86e21b35f985e4bead525d268c619f34a71e4656c653cddfbc5682fabae0e913ce0cea440942813471a65092cfef83",
        "c8cb5dccd29092368d222b6dc8d06323b1bf8b04169332065a95e2e8944de22235d0965774c8c12289c34e00864247f0",
        "c2126c145130b13ce20bb3ba6c72d372864022d99489c55ebdc7007326d350f2abdb2228d8768507b2d3f2eea30979e8",
        "588f3cdb86f35b12abafc50bcc7d3a54bb1273925826b0e3112ac41712dfbc7bea5c31bb52dd821915287ae97b6a2258",
        "022ddf6249b9225ac5092e5889b2df02317955abd436b6b0d8c175964487a2f4a88de21b9cc820f1b86d5df7027a4fd6",
        "250a1304fc9647e8f1522ba76ec9227f75b0fbde82e07ae9493147d937dca1da45670f48929d0c88c83907ad3bb2dd51",
        "fc0bbaf0137d5adc22fe620f9820c85bc1793b33fe4f5464de71d653bfea0b7d6d33e98be7dcf85c6c97cae81c96163d",
        "b29ef305cf9229edb3ae33bb21b8b49e1855cfe71ccf8863127f8ba2227231c0a25d849c9d34f2dd1f2a12a9e0148eb7",
        "43a11c1bf65d344f56cd86f809f3d3ef4d30e84faa4136fa9b5894f6cfef5b256ec6e51459e592e49da3156b6f4fe5b0",
        "46e86fc386c080453576d3346d04cf5dc3f6a29bc7aa996db92621cad99f2b56f082d1eeaae7521ddf42b9e03c80c42f",
        "9a23382a991df68d3b6ad497ad7aaf80b75eddd0f14964d576f49e8cb51aebfaecaf95903b1b386c585cae667bfd6779",
        "3b90cd83ea39f98ecd0488ff3332c3af160cb107d6669975ba9087efad343cba352bb54d0105108e7545321ba10ed349",
        "c119b94ac02f92bb414d47547ade83470e42baeb5698afbffcd94035bc8aa6434419918cc8fe80441c87821f3bd611b2",
        "3bc99e575a90b155aaeca2020734144e672e3d6a5ff10945e19e202bff74d1aaa7943cb3d7f0e0f978838e07e6869c2f",
        "ee1551c1815c7039d79ba616c2deebc9265244796ea876b5b99bbcb1677e0f5d5bae01ebf7ef63a565456c0442a5dfc8",
        "39c245c581063ccaa019c4568724d759b7ded315a3139028424356c0566dde5ef9add66032437c240def241cf69ebbbc",
        "fdf98c8123bd0842b78954e48feaaa2f39e3491fa24bba00f54caf70b5d4cd0ed52ab2f03dbf2316c5d7d2f0b986f3b2",
        "a2ca492fde0d85b73d8302878ae0185311704fd09d1496d87d077ab3bf405dc7fbbc0890e2763eb81d30550a9ae2c7f3",
        "4928883072db756f0dd15ef1c39df5b8431b363671dda130b933a870b50a3791d7dcc9ab45e9712d83e53ce3d300df6e",
        "818d0fa6754cb4cfdd27fdfef5995f3a78b9f54341b5e4ed42b8c5ca94bc14a7295ff4dcbbd51798fabcdf38945e3382",
        "93ef85214df304026eae9416bab3a39e4058ce76ab03a2ce43e0687eacea9f43a11aad1158ce81f71c02aa32fe31022f",
        "b51005757f2d02c9979d2cb660a20bd4a2a1fcfb0bad8a60fd1d2e06e37aee34ca1f72d6cd277feb9a2ded3db04ca45a",
        "3b0cc7d679a91b54a8f5f06cac11c4125e250a72e16374e3e98e279e46435d802bd5de99684f049f5f87a67c760e03ef",
        "94bf0c94a6e0aeff4d21b33c99086cf04c5468183f03c2159bf2d3e7104148c44a4b0a57f19a3cd107e9bd4a39b7f6a3",
        "39915cb59ee63307c986e0d1e266ef8437ba7e98fa5b187852ac092baacae903f527a4d55c8fe8245e873b890899206a",
        "60796ee9fee5bf8d60fd312dff72c7e7458f2335f15c96db2cbeb714982c39b6c2cdd2fe6824bd8734fb0e98eb42f2db",
        "43459853be9f1ab27e263ad8ba7d5db53d321746c63016d9d8451f9dbde91ef2f40c5eff5c24f89a2615b7b16bb194f9",
        "4c8b7e93683132f1d4045a2615ba13cf871b216ba21200d88699ca0eea4a2c03461069c46a9ab7c121dff5e665cd3e5b",
        "714d7cca7484f3372dfe255807aa18198250d6d6e721c29a34c0ff0ee476d42d2f27dc5c4a69328daa7cd2b036c02b6f",
        "07d764999592ddf00df6c39eb8bb72106b6bd9233c24d8fdbc99cfafe4327d51646622c65257c171f3c321ddf35ae387",
        "cfe5f459afe94b8ad2ffa87a275883a9a77d1af2fe1cf843e5f2186a8f27c4065ff059050370c0663ec1dc1ede7e20ba",
        "c31aeee270e679b433d1965096d3d9b98ae979efe61800eb8a884ca042fb41a820b00aeb30102618bf1a4d75cc9192ed",
        "d52a00bf4f2ff9a949bab600b76e1d77856d44e16520786064f224dcb8ab2fe62df11de7a1cb91a9225d9a3f24aeb0c4",
        "c14949bf24f022c3ebf9c4673648f369252dea794930c4b9474bb4f51292c54780c694b7475f1d26e745214988a03cee",
        "84c3b98c82b2259a37ec94a73cdf09b4beb8585dac5af7ad9356037fd38f359a73d23953a9bc62e1c870ff66308e99ec",
        "0959e311ca025431794f76cf72270c820af8077ca7cf92e4f6943e78420f58cc441008c864e15c051a82901c096cdeb7",
        "405c306a1916960c07ac8a910dc86f388909c1ae6ef05485c38166fac9dd4a5d5d0e5c64e4727c1109659b8db4b7b921",
        "fd3e773c1d10fdc27a06781bf8bed0b31c480dc0ea06d2f129083e802d9d834c470e0a02c79f495d0d8aadb490548316",
        "47117bc70bac4bae032ec45df7168a6ebbe8a86952a1102b0b84378115f487e672a0dc9d328ee3854c18b6b644e93ef3",
        "5f59056a602d5d8111a51ed550526e56c688ef15f3364d0196845069f310483237ef0932d537ee1a952e5244f51694dd",
        "538d995b251d937b225bd111f236e72d849e153122b56a9459c5bec22d7703e3f48ba66661e859de0b434c894a412637",
        "b431eed1aaa6d11face7267fad8d94c234d404f617526752f5c135621902e31003bf05e34c4c412012ad9e2eaae500f1",
        "2e3c23cf1e331309aeef2526237a6e90bc8282e22ea9a96460b287c9835c586c5768d9fa9456d736e26789fb8add3129",
        "0625166ae8208cad1864c95fcf8ab3221b0cd8d02226dd32cd01d5399930b506d31b57e6172ca39d3e9ecc24e2aaa566",
        "e66185b56ba4b13ce1a001fc2f8524885340d63c7f7f563cf9c3dcdb53ff8d927a1d50f23ea35fc138b9ef6c705fd245",
        "6b4f97b26724ae08de771993accb63f98e96120683af1d436ac3b23b7f0cecbf0f2db180cd30134c850ac6fec91d07ba",
        "c1f9580a9134c809b936e27faf4f587430bc346afc72e689d612a43fe524f82fcf0f2135b157224be668ff62a98fa7c2",
        "fc0430752cfd10b8bad3e20f79998f8d8cf0250b91c32733ca8d5684014ff4703a6eea5187ed2a3b2306f8a827e36cec",
        "602c8c93e439a11de30a30f492b1f65369c201a54552826e9d9795fe4c92f8dd2b9c651deac5e7b7b6883190a222a71e",
        "b7b188918e5bae47f0fe5ff3e83d12aba0117e81c420d2f88fdf2046ae6989d4deab319581e3603d5b9ad6f1370d8359",
        "78de61351e91adcf7a3e9185ac273dd94a0f1cf31c6bf6fd1a2418f4f0aa4d213ff1c653b1b8d3ff358d71a8ad585400",
        "6c91ddcf12e1738616ce071a2255833716c595f1a100cd67b8cf82a375d6e6b9ba7f41b32dc7c546eba1511e45ea3c98",
        "d6dff71ec2e05a25aba0e2e874c2fcd4bc0263250048980f5afc2fdb223e893fd20fc906695197ffc5d06b903b3ea938",
        "1d89dff6b310e83ef1eb58e9ac469fcd44216bdb6edd411008ee5b301767f59b98d96bf392e35e6f14beea8b26de0f97",
        "6143d5ac107b23a7e3f4d970364356d250c961b662150755e4a2c6c174bb5017bc66053ef488d352cb51b09244b0d7a6",
        "eb4c32badb5a4bed4e48a320477a3631dd063a9ef423fe314bbe21c7db672f13612af00258792e395accd13d3b4f2a5c",
        "520ee987f4d05385feee8ae1400fd3b5acdb9255b69d3c22c736b5d131ee01386ba4d712f88d9e8ee8ebf8ffaefcdbfe",
        "e8816748233d37062c27818c2e83c12d49fc54b1555a34c2188446dc3765620bbd87e6b11ffade1fb6ab7e0aaa99ca9e",
        "5bcdd330b537905cbb24d72f462b114f4f4c306fb785371a42bf3a6831e5a385fa9580c1def9ef678d0a28d57000d845",
        "93b4e0198b7495d12debf95ab635ccb72884f292334a07865c36611934463487919f33af206c9261b1515c6ddacfc01a",
        "3e27e45d1479c67bed776c86f7e164a03935ed45d5f1ada22788378caf17ca9ba29723e093edc41953bc42ea2a6f3338",
        "75b50d355c7064b3ae25633c810dd1754ff01637ebd6058ff81a235b4012181bf5a04ca88b819ab20ac99d10c038e722",
        "c991ace569e2d99fe1372971498e7a2f6d70136a21f7f2d4a77af3aec74f20299c887b5e5ddebf2132a6b6b9ed46f804",
        "a18c0d1bd0025a2660db809debc881c64661a25f55eaad0c5de8d4fbd079843321178a09ac46eea1e8de7d6dec7ee73b",
        "5a9ebdb10879b40cceb2b29868d6bb7f09524c5711229bf691df62b763ad1c94b857568adde50a2bc23f49029372a485",
        "64cc7355580960dc3b585739912bb56e0451be5180d9be13ab31fb05d823c5858df84659bb842766e737585880640c9c",
        "49f46a29f4e3aaeba534502553fdb4a1bb5601ba47c62b0cbce7b553eb75cff592af97c2c6afc60b08cbe87ab4a00534",
        "8a93ab503abf4bbcdc0ad12415cd64e1d4696a0e4d9e3cf9cff9a5287d6f31387d6e4e74878c22d403a3886e172597df",
        "1ff53da4e45138163e25916c6228c55e265ac71cdd930d25e2490cafa81fe31dd8c1d8dcb0d2b9de90389a231447fdff",
        "ba94f6bce7503c5bd914cf20d932cd36452dea975b494fc2b52bcd7c73966edd3df6dcbd0f3b31eee1c67d1262a5a0f1",
        "5b99b81f81dc134f150cdf573511d444bdfae9f0d14faa169e1e032ad05395ef63c32222b9f2b29ac695948a4b91b962",
        "2171c89ea9163e9044ee71615a957948fcd4e0fef2643dadb20ec8b1b09de3b84b8187a30d6cdd0da8f6a70b60812af3",
        "a38fded1e1d91f06f8cce5f6919e477d79f292d2a18a08daaf693cfc10b148fd8236a89e88fce4baf9e012e230be249e",
        "47e897d845f1275b5e730f5025adb6047535fc9a87eb812f7e706acbf29e72940045f6c067e92c3b744f59494101b165",
        "83e39a3e1788f639a9aa794a046fbfb8fe34af5761770b4c2c23c470f23641b8025cae1de46b8a4b512bae9bb26da2a3",
        "92b1ca81373d45174dc494a666a313804dfc487a18f194c0dfba8ba84e2dc6459d34a99e7317307d1cf0da89934afcb7",
        "d0a788ee9af5734c2f6758b01a8e059f19dc7c174a8f4d61fc166cd1b045d094c3b5d4f537d103795bd261da29c7bb96",
        "c731aa7ed0e8ed651181782d28f10828ec2c9e0680cdeb173505af55e7c137f01c14a4edc21c9538e5e351efca0eda67",
        "130aacfa29b3e919e9819768fc973ab889faf0b5d119aa907202651c2dedcd22db49ddab8b0d68327fcc594844e49529",
        "911babd952d752afcf8c19c641a3b4b6499c8897df2fd30d07ec7c0396502d8820073b0453a7aa5b085a3e867554ba47",
        "56824c8baffa77971c0bd1933aad5627d646d1b451b4cc3733fe47f3500d637b5c340efce85e5e4ed2f4c2bcf11b4407",
        "cbe39636805beff7fb3dc80b043b81445350dabb98be6fdae4b6b46f5b6b6fbb9840c49b9151ecc0255f5f274df07173",
        "f73686b7a073de7505d1693be123ff3253b92ad1251142f49c40c7914ad8efcd8b17908efd6c1c6198e98affc2d0ebf6",
        "15756841a1a16a7b9215a7a4da65c2c9563de38afcce411a0e52ee7d6c59932798020e491a362a934b6dd2c2737f8b9d",
        "539783858177a9978bd299e252680652ae27149ffa11ece7bc0b696e80dd78d6cc27994b4900e8692d75619f59b25147",
        "ce4dbe3f41d408df71f421183e8227013efef33a09bada7e728a3360d4782bf0e5f618a06f79a1268dcd4ba97d46318b",
        "4236ce7b3cf4013d4784beb1f5c06dc8b8d450da3c98744cea714e54dbf1e34cd0b8af185f41581cf79d4fd3e0ee342d",
        "40f008ab7adf8ea3864fe8d3f169b5fcabb6e670cc67ab772d633f2233a21bd3986c2dc54c17fc872d62ad96abd8cf1a",
        "fe393adb4ca6165824086c8268f3048cf53931742e345335ee5beb768aba83f9911d0ee07d341cf1b4b61f59b0de6118",
        "6e547f038891ebb82ccf3c6fa36181b755c616dad4840c66531533dae1eb718f68dce2e2d29631b7ca8a62d7d3798f75",
        "3f2033cb195db929165310584de7d21fbd3f412461623ac103c55211517dc8da4e4f5c5e9aede9861424927c41f794e8",
        "d64ad8a0a925c7db2f81ae6527ad0481f8a8da40dc98fd24e97069f4f16eee9df45d70e82305752a7708a30e1bc27ef2",
        "4ab3db320c69d3e7f0faf29646e73ad42f6221a8244a88da5283949b5deb25870106f20f1e671fe7ddc1299c9358dc8a",
        "a8cd9f553c5cd061a68f61aed203c4406b08f6ff278dc5f257244cbde47802f21ec98aa4736467bda20ae502e6c1c917",
        "ba3a59562d93b3a35e163b74993d83085f5b016a618de2811420764f7e6472f45efba260a9211c5ce7af374730aa6857",
        "97e4593913593f928ef51017ca3c1add876d0f97bafd03774167ed7020d2a2a4a21c62f87bc7c22a47677e2ffd62084b",
        "c37422e9fa9ea9bf1a0dc6314ccb0b5264037154d3c594b0f6906750e591400e0dd726c1b7fc34aa5f6a1c13e539dd98",
        "1e012a213db9dd0bb8c5c13f200c84ef43fe4a197e88e6741109d8f78909a9e1c0b179fa80a69e077d666942ef15959c",
        "be1f316ab39ff4af4067d6c4e1cd03d9cd9fdb0d4a3855d65e99d45c5b7bb203e90243e6c602a6fdd94fd7980cc5202f",
        "ad6d86e82e6508ec29459e43a58f81fb206a7a8fc68130a1934c2e46ec781c1af122151f2a18dca3fce733c7b6b89b6a",
        "52650ee92c843697608eeb55168127d8d01b5c96039f67ebaf4e641f57ba907e881577040959f7d11953152a48fb57ea"
    };

    const std::string m_7000 =
        "5b8d1ae80ddfa91e13c84e284b88540141cabb71a2972eff695a2313dcbbaabf9deffb9f5bf75743488e19d5ca0493d5";
};

TEST_F(Blake384SaltedTests, Simple) {
    EXPECT_NO_THROW(m_hfun.finalize());
    EXPECT_EQ(m_hfun.hexdigest(), m_empty_digest);
}

TEST_F(Blake384SaltedTests, ResetWorks) {
    EXPECT_NO_THROW(m_hfun.update("Hello", 5));
    EXPECT_NO_THROW(m_hfun.reset());
    EXPECT_NO_THROW(m_hfun.add_salt(m_salt.c_str(), m_salt.length()));
    EXPECT_NO_THROW(m_hfun.finalize());
    EXPECT_EQ(m_hfun.hexdigest(), m_empty_digest);
}

TEST_F(Blake384SaltedTests, BasicInput) {
    EXPECT_NO_THROW(m_hfun.update("The quick brown fox jumps over the lazy dog", 43));
    EXPECT_NO_THROW(m_hfun.finalize());
    EXPECT_EQ(m_hfun.hexdigest(), m_fox_digest);
}

TEST_F(Blake384SaltedTests, ChoppedInput) {
    EXPECT_NO_THROW(m_hfun.update("The quick brown fox ", 20));
    EXPECT_NO_THROW(m_hfun.update("jumps o", 7));
    EXPECT_NO_THROW(m_hfun.update("ver the la", 10));
    EXPECT_NO_THROW(m_hfun.update("zy dog", 6));
    EXPECT_NO_THROW(m_hfun.finalize());
    EXPECT_EQ(m_hfun.hexdigest(), m_fox_digest);
}

TEST_F(Blake384SaltedTests, Extensive) {
    int i, j;
    for (i = 0; i < m_cmp.size(); i++) {
        EXPECT_NO_THROW(m_hfun.reset());
        EXPECT_NO_THROW(m_hfun.add_salt(m_salt.c_str(), m_salt.length()));
        for (j = 0; j < i; j++)
            EXPECT_NO_THROW(m_hfun.update("A", 1));
        EXPECT_NO_THROW(m_hfun.finalize());
        EXPECT_EQ(m_hfun.hexdigest(), m_cmp.at(i));
    }
}

TEST_F(Blake384SaltedTests, SevenThousandAs) {
    int i;
    for (i = 0; i < 1000; i++)
        EXPECT_NO_THROW(m_hfun.update("AAAAAAA", 7));
    EXPECT_NO_THROW(m_hfun.finalize());
    EXPECT_EQ(m_hfun.hexdigest(), m_7000);
}

TEST_F(Blake384SaltedTests, UpdateAfterFinal) {
    EXPECT_NO_THROW(m_hfun.finalize());
    EXPECT_THROW(m_hfun.update("Hello", 5), std::invalid_argument);
}

TEST_F(Blake384SaltedTests, DigestBeforeFinal) {
    EXPECT_THROW(m_hfun.hexdigest(), std::invalid_argument);
    EXPECT_NO_THROW(m_hfun.reset());

    EXPECT_NO_THROW(m_hfun.update("Hello", 5));
    EXPECT_THROW(m_hfun.hexdigest(), std::invalid_argument);
}
