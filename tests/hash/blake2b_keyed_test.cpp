#include <gtest/gtest.h>

#include <toycrypto/hash/blake2.h>

class Blake2bKeyedTests : public ::testing::Test {
protected:
    void SetUp() override {
        m_hfun.reset();
        m_hfun.set_key(m_key.c_str(), m_key.length());
    }

    BLAKE2b m_hfun{512};

    const std::string m_key = "supersecret";

    const std::string m_empty_digest =
        "03d883774b2f6b8140c3a218ec3695500a8b572225e6d0793f5d1c0dfb9e571feae2b191c317f7014556414f7ace312ea2f433d805538ea782d72d4569209e6d";

    const std::string m_fox_digest =
        "3142906a6b05c564cc9027c0958d1356c119371d670c7dc3486dde4b237348b9aad37f8acf2c1897bd26df01ffc8c4392c6a4602bce566c183dab3975b904856";

    const std::array<std::string, 134> m_cmp = {
        "03d883774b2f6b8140c3a218ec3695500a8b572225e6d0793f5d1c0dfb9e571feae2b191c317f7014556414f7ace312ea2f433d805538ea782d72d4569209e6d",
        "c658806cbf6c8768826189cfaaab372fb9327c70e603381479db8af34905a2a7abb99d32b9ca42aa75f2974fe31992a04eb9e07048b3c8ee53c5fe5b4fb3e5b5",
        "3b10bf0c6ff30af04983d581d2a4db5977aa99cf95a682691b5e3ed931e9cc338a6568c3b63624b1b8f527b779a8527d4763d951dfa471b9eb4fc5239fb010c7",
        "1448656709f3811c20b5e2a4ec86f7a8c82dade120a06d367160bd6feedd915afe150f4a871c261b2d65c7675f740a223eded58a99e48195affc0b6f29115364",
        "ce455d9a8550ee322046a912d7d1164318cc94de75d803658174ffec36d6adb411578a0c9da429ccb4e566c416427ec8aa484ab257ea8fbd06b1beac2e60c9be",
        "8146782f5ae101c2bfd8ed855fbdbdb80d5041b9c3d8e89e36b9fcc2f78417090c94e581148f283542770e6646d7ed0a3c43062fd13a98bb4da3e7d0e3ff78aa",
        "6ab66871fde610dfbe007b93fa84f199e67b7ae3d396273b70ee3b3c57fcb8e8d7a493852ecc71d0fdaede18eef751ba33486b702c6bd1203defb7333635304d",
        "b5d3966b405f51eafa9002ac2815b8d7cad8e3a0af8df0d940736c24221fbe5ab7b07a7add481b8a392d7c2cb9a7125a5d3b8a39a46716bdf402dabe33300918",
        "e8bec7d0dcdffe0c82b06467ae85c63580774948c52d18a8399c4781ed8bbb2bbf62f11bc9e0044ee994e674eda3c12cf0b6dfed392b7e15b70b34c3324c005e",
        "4293913a4ef8ba16f8efcddabeaaa00949c473f130cd836efbcd9ec1ead70d6d2e7ab3a2c7b5c80fdf5cb84ecba16f612b7d5b43da2228e460ef8547d5e1e7db",
        "6230120ffa19fabd29d8535240e3dc3d66ecbcd463b2cd8680137e1b8dc06d27f46cc8102b58fb6cf0f7320d37c27d4fdfaab7b08b6eafad06631b5329711012",
        "b76233efb664309d224c80572a3d00cd5cd141288ea17e739c554d35379528a2dd2124ea4d3c390c8703788ae3b1642cd8a0692cb60189f38509476277aa2a42",
        "e5029084e23af52dff94b1b36be2fc20e943a04e270b24309028531d7a75fea4c4abc67d67b38241ac426af50fafc0ef1fc8b8f740da4b94fe44157b3f697854",
        "189ba1107fb44bf6518225c460005e1f58864c9863a0cf302374fd09c966300c9eac4ef49597453bdc07f2d886b1758ccbad9e78bc34543ba3c64a506a176220",
        "e776dd134b3981344724095dfb869913183db823ebcaa8ad6636760c4411dc4990fbe8691a55d5e317664f0bc84de9f4c42f4efe9105f685b20893288ebc060a",
        "d57f1669683f5263b5826d2e51d8ff6c2d3992b5f7457bf694236b1f5646d4846fa36f69091bcf6e26160b422874c19351fc4e577443360b59425e74f6644bbe",
        "7fb1d589cbe755a487e64b66d677980b00d8480763471ac11aa5d0395dc87c22c50b4e913e959681884b81bc1ed292ac9f12d0b8252faa91d37936a942fe2636",
        "7c24cca3aa6a62b6c8119b0ee746ae2e038e110908f74414d7131d1bb4a9fe66004c2aa5a39a3793f9a0527b01bf33724774b495187094275c9dd0a134833352",
        "7e0a70618bd1a454592c2bc153084751e223bb058181a7e0acbfa17ca2da586e1952af322de681024b57787467fabdbe748f394751a07d8e965881160f61063e",
        "97dcee27ea174ec158fd58f70430893abab67546fb61d1b389b2ce5f7d9f43403f4382d084e5b7abd643019b5824fecf9565663077f20b22deb09a050bd92c01",
        "ce4d52e05c6707c03d1fbbd0012472718f9aeb31ca3c7e00b629bfef8abfe695feede3d840584d04087f1ecb4fa85cb02790d100e087eac1cc721e5748a08144",
        "afdaf2a59ebf26c632eaccd9999f439f19ad38f7a66e909fdd7ae894639a20561280e9f39ea7c08f874d86c48b8c86608996290980ce47e3487d5a4b27ef0a3d",
        "66f69ce74949ea75ce96034eda372f454c5447d424f11e418fa6c1279fd0274ee99d8c3a82dd076045629e68a02c180ba675d2cc2f1c20004a97979afe94c858",
        "4ba782093f310ee60661aa856773838448fcb46fb9159059a4791b2c9696025ee693b9713d351e31120aab427265ad416ef2b87675ad8b2e977ddfa0fd2e4342",
        "8bc76c5e223208d4c3b1c241b2e44cc211dbd743dbe5fc73fa06285264f7abaa9ec35fd7313fe7a1e201b07c4f23d6cbbf24ad6a7246902696ce795dd7751057",
        "0f23304edb96734807d45bcc3fdbc605c19e5297e7f5e03db67d370fd1235743065c4f7401d4a7ed2daa2c64b05cd5e7de5861215c209934cf9c6e7bdacd8a5c",
        "512a7cf2d97316d0f2e2d07dfa645af7784a8023f9eaca55f3e1a559fc8aa2d82420604d4de43106663c6d573dd3f03577220accc0b4ca7d888706457ba55fe1",
        "662765c512a8e23172a48ec03965b0542f956d1396f5c725fad49f44f6d44e7e1a437f76bfcf2fa49d7c90d8a79a5fe702ca3cfe9d2bd8495968eaa09558f9d5",
        "9d8eff7ba8b047b88cfb4d17f1b1ac3d30f9abeb4ea3becb2becaff7ca8004c9d3ff196879db6a3ec80dbcca7168df050a6af74e13e36774d246cad04e934937",
        "bcc68d823cc3f1d0b34d423325f13e0c156508ceeb4a582c31dd802496fe479f1d2d6acf431aad115ec7f8b37fbca659dfdcb7f8984c38d92a8f9e2b88964769",
        "585b552ef7b26cbe079f929ea8796ba8b9224ad862c76aa1ff46e2bb52b6182ba700d63e8cd5949d3dd019a15064805e146edb3b01e1e9aff6943626823e29a6",
        "1566310946bef17f0f0f5145d68aefc3adc2e42ccd6060b814570a90afe399804b8f764689ef0ba18a9cecf88decf2960ffef5df0de96695ba3053683d323b41",
        "b976dc68a6cf74c3579b29b882d5901e71e3e031ade3980f6d22ca74fdcb904dfe8407394743daf1e65c948fd88bc202cbaf2e32dcf008b3ce23640f3896b66a",
        "c483594bab5099e7279ef7b75a8e50c70e10157d42a8643f91339892074d4c9a3c69b123360d1ffbd568b5f4932cb7db710227650f9c7792660dcc9f38c508c6",
        "587eea053d32e5e9ef9315122ed3595d812a5af46d92efa2d772dc85af7b9b9548a6e295e7039296a2a4d5f235cc59b6a14870cc3d88b15075fc36dc1d6beb9f",
        "aba218e4691ad3eb27ac100abff4824ceb034885c71d94d5b0fee8e59fed2eac2f6bcd0041281e9086c271dbfb3556f1d89b181f85c0eec55e8caf14b5ade62c",
        "d9424c0284229c00c392d3ea51b0cd47fa498f78a65b32c9a7c1487c5f93a97a546dfddbd7e737b0562cffffb1dd7d011716c588a0c580c458355af65d62086a",
        "41ed0f8c88c32de57a9e4735e45874ffeceec93b60f79e07d5c657d820b62d09878651b5c85ea40be0d680cd67d8564102abb89a8f7e7be301850e55b37e6f08",
        "655c42c9352b14dd1b9b7fc2194a2219a3da0a8775b57e80aabe481403377b9a64bf2cc8ec8e117c3d0c54a26719be55c94a23343673b92ff9caf0600dcb1d53",
        "073b1712e8a7eb005e724b63ecbe8575d9219df628377fcc30fc66cd0742b2033219fcbf5a0d0c0bcf828994c9ce0c124ef729887f24ca793894fed30f3ab945",
        "58f0cda9bbd8feb2a63ef0ce5aa75415b63b55ea46eb66ec092c659276d1e31c702d4f6bd4513e7d408a2d117a86bc095c5bfdaa1f6acaae8c34490c5ac610f8",
        "daf4777e9e7cf7b2cb5f334d5b942923f53a1fbf65c7edc891ee52f7c0e6a77fd7e907e44183ad6ae24ed4812b526c0be1f629f55555dc6cba3371a89f6baf58",
        "b1aacfbb0d42d57721e1b034e24f397d4d0a8b8a2237f43a52cbbd38b0ea2a2e46cb0d675bb97b8e16752f756d4bc24b042f0deeab361d81178b229152030386",
        "11fab5ffee482c6d86d97957f60d7a926b754c72dbc9cb85b6120b3aba4289ba5e00a94a2db253b2b1e2f61f073ef24df7346b974af2cd4116988e81a968854a",
        "7406fcb3ba4345a1d3951bb0fbf838793047e1403d46060fef0fab2b275954b10ed98b1f42fb188b49908f5c74c6ddf3beb6981f33adc76e1d44fb427d1d1bc7",
        "d79cbb2fab58122f8864b4111e57d2d92bdb2cb9acc8dad84a443bf548e9797ab0c8a5a0ac22a4251afa06b605b3f4d1ff537d000faca55e169369e0b74ce019",
        "759c2198c72c221c29674d173f9e1c37f41df9643e2b57c5ec1d5bbfbf19fa1b8eefd52c9d3d386f49c878e9867cabed1afe9a6a540594ebb44f3878c0009859",
        "c7b4b3b3ed1c7e0493940b43bea14532c98e69f42a84d66714e2dc577ff88f3dc822e232a89703652fcf91dcd53fab3ad7910be30d4bc8f7343e2115487e16bb",
        "0942bd17c61eeb3cae9263233fb746b069238cd3b71ddb6d45b9baad2f259b91419ea2638783a41ed9128abced061658f0207fe0c2f717076bb0158ddcc2050e",
        "21fb606f064715fd51c77f3ec13723536524583ad80ee6596fc5be37f1cbdfd97390e5f3e562a3be312b2ab4c8caaa7561dd8402c5fa0e396fc453dfd7a0a1af",
        "c19bc19ffde6a925ff868a59d2561bcf9191df4271ede1e058f6f10770cadc393482eba0ef1ceeb12292c8d51f6d1b16b85ae9448466d4ddab6a32b0b9a71e9d",
        "0fa0cc529fbb4d4b0942e27c49ed11020484984b9f55d5e245d31a28f2dfb4a4d1003db0bb8de6a592ea4292306141e3b84f50c65aff2644ceb348b559424af4",
        "9040e85f09c10425357153e2ddc75545a54c0baf1fa22874a86fd2095f4ee237c44d6f5e4ff43d3f9cd5db1aeccd9dcf7ab58cf8547e823f4d0e1653c960a66a",
        "e13b8919009851fe291a017e0b09df05e20eda7daf2bd5406a5ba3b6c2e4af1b5de1b491e3c34dd3cf4bd92bdcd9f893b150cff1b1ad7e886cab8c3617a41eb4",
        "f004609ae13ca632cf0eae2680d1ff82eece4b19305de94b2d19037b65cad8f8c3157abd3779dc45f39e356e0c3f0ee019842774c84f065e557c937b3f07ae41",
        "40aaf2184205935a26b7c703fb4cfb2e689c1bd9966f678f27d8ad78601aec181247d4c99f55bb2acbb80622785a197529200f41914d9b7fd5b04e7e567ce3bd",
        "9ea4a8024e6bb800b743421a72e42fc4a68607f8de178036cb19f2320710a26ff66b10a72195611425a9906a9dfb44eaea4608ac27d9fd92cca73d6339efeace",
        "bc8cd8fb2c6ceaad6f18866ffeef1ceb8f54e2e4408a41928dce9f099bcb3c8a9915e1bfda5aab0f27412ce64ac217ac671e03806674a6afe29ad3740467408c",
        "a5490c24bc57b5938c033de7db05570a4103ccc40224c2c9395fa1f002ab9e217308091ae3be04e26baa2230f52bb9fd3256cdf8f9814b36f8c65660d6339fe9",
        "1fc2761099b104be935923752063a284ba00566c91888bff5dec5051da8d5d81d6e8989fd0258d52a46bdd7aca388c43c81b812463722e4764a3957fdaff51cb",
        "53520d00efe0d25fd05d25c85f9b7d5807f32a5fe7c92e1667cf762bc4f0950902e25987be3e4e082ee76e6e270997b3671ce21670c6a8abc0cc8059614d1321",
        "c022f41ee574d7f5556e21919c156e998ae4adb4551a44ea70e53a68096467916d451c271b282338c3f968f03fd5995b090a2a2412f12efba407999597c5d0c9",
        "fb823e9c8eef83bbfd69bed6fe9431dcc96bef76ac1c8a7a49f2490a5bb9f780bc1f475f1bc3851294be108be8d7c8e5c99fe8ea76ab3e4fa7e5f6fa418b74fc",
        "31cec1eb9282ad67b15935560bc5350a3a558d3a3d0189038311243dc42b94553650eff9433b390c09b49c8e3005e74cf63e7504d753af15f5c24d74fb49470e",
        "9b1dc83114bf0fb3d75299bf1ed38adc27752236fdef9904aff617e49d45cde375ce9bff075118b6fe684cc6fc40d86e2cb157e93e46accd757a91baf8a7fbd3",
        "37a5d778cdbe320db1d820dada5361e7b1cb03aa3cdaa3bceb9ce8068b524c1ca1bda7736e318d7e70df4406383e5432a8d479b523d32e71f4e98cfa94252775",
        "4fa9bdc8a4341f7387392474cb33b841c231ba7da9014e27af132d635a53a081555f6716eb39a072c05f372a3904c0ffa0145a7ea450aae36c7d7821d72d5a55",
        "42a95de2661f7caba8274cebdfe7ae558cafa7d3009c72f51738e058dc4b56127268483ecf18130b8913e74779a7e09ad7a53c4ee075c72d09b9623e5c4ab205",
        "050bf792a4867ebc1d8cb6ebcbd54a1f8d2b0143b752fbf999d565b6e01913f82a47274d25f28e13b72005d144c1cb6eba96636349aa6af9976edb5a1a9e5771",
        "fa8995cc33220b3bef6f4e8531b507635eb50f5c3392089335837e095323bf0c795c7a47753f1963626b454678dd9ae3f6481213ebf916cd32915e24a0763f0e",
        "5540a11bded7d367c5bd27b7c4844c4455d1071057fe82fb4da5bf423742831a788ee88833ac4af1f36486cee0cf7c14015da581dcfd7fac95b68d29a294114c",
        "50cb74a01959dcd520dcd68ac7be839b48f274111c3c2f9ca28e14fae680e8511d08f3a7af5f409c213e4165bc8e1e0415e7813bbca5ab0a17d9416f936538dc",
        "4e51e951d42525b55d6c1552adf041478c8fddd18f60b29b44f262b986d8395f2df08e3cee1126bd3aed4efcb70c6c4425689504053e751695d1982989bda66c",
        "0fc8a3a2460ca08f8d82f618d4bac41b957affb022f8347cb208fa9432a138ea3325e3f1129db6cec12c968bef88dd4801d40ae843740851962410dc383e6abd",
        "a603c11e2f7c8d252aedf5cb3265268aa82db2458b28cb5a67f410ece08be3906e54f870c2c05d7a28e53d4012db279527258903f77b70b196f5c805352d62fa",
        "79af3c075b4f941cbc632cb331e71b683049cfabe527033508c2d4038166ad773a271582518c54917d91a715ae506172d05df917fa3d0c43e5574d38eaca95a5",
        "a47b38d2414b475ecc2f0aaca8d2bd52d6f6527fbb2943df72542587a3d45d4a8f5ce231ab86404e0c8c6e2eb4e016a96013f42e3799ca717863228e885e5230",
        "e54da584e4afef3880f531d2f629e9e1a57097fdc614df4f932938743624648cfbe25e0c19cb004214ee37b30db5e9f1f48146c1dc0c08dd7db1ea7d07e6fb7f",
        "dd552d4fe2d46900247d43325cd14d8b505f1653a86dbff1a38d31d3adad11240a69311fcdeb877c2930f8595abb7e7ab3e23c70da16ced0400cdaa32b9d515c",
        "814c6b54143b505ea07a7bf1e86eeec4306037c9d591604cc25946612fc3b40d18e3d2f5f623d801b67bf7d18afe0832c1ec6f1f63830a2e01cdf4adaa7e87fa",
        "42f9cffe1d24f908db62f748f44e62b969c21dbc70cf47f9adc88e261ad55f1fc510c547a78e62c0980c92bcb28212bbbebb056291e9bee596385c168ce93311",
        "bea8123edeb117e7e4baec721bbf5e58009d6848e8d592355a265ec222ec0983bf320f1b4a04bc6bde75bcdcc6c3dc312d38ec6eb8a165a8a7195a6306a5a7c2",
        "e1f365d62a228a075b6a9df2448116a36908edade051024cb7f2b25f47927ed4d127bbd2c10881d02582881504b5feac529fb877ee1778a1db12f8807f9aa20a",
        "76bb6221af1db58fec1fa537cf257da9c3941b7f0db1bd7ad21a40a476e6a0211eccc18cf7c5bb87e70ba2f7ec2774285c8317a061feeb8dd6e287f77e586b90",
        "8d278a9e36ac5b37bfaee068e25051905aff550afff862f315d390a8666d3da2962f2f4c8abaa259716da8acb5a74ddaf9486f78250135764b7a9a9fc7024c80",
        "6c9444a4995ced0f09da5de4984a12847eb30479ef5041a4ad4bb3e466ee8c223aee32a769ff4f730266fb4fda8685554870cd61f3c2a6959c0dda06c35ba1b3",
        "94e5d04df157c750ef9bc54057e3bd04e723649ac66a9ffc016baf1b60cb9fd32973f34d23eab76e4b179ac53e7d535480483817c7c20a081f0fa4a9c4996f8e",
        "e1d4817bd70060c90fe4790aee1e0c1d40e18178cd0ff716cf602da488945cb06d95297438a1f244e442fff23ecc7a2b2b5a4f21ad1fd2200107bb6a1e59974a",
        "2aa5db9f136f70efe24959400eb112b9769752f401a8d38886f623002152232825e627a181fb3e619b1a61f7d304bfba0a4a615d3ec0bd4ddbd9eb081ed7f86f",
        "b8cadb7d89fd3804347988e8333b8ed5192264186a51f4c6ec784cddf4c724f42a8ad3f39dbdd599cb08ec7b0301f4b713bfa04ac3f7c8849768b724d6f2bb32",
        "f7bbcbd04d376cf0a2d7ab412487711e233e5e6969eee622f9f46f289548796bd6b7b1f6c248d2e373469c4a1d5ae854d73b15e2c221b383bf582ef633c7e471",
        "eb7426117ef94055ddb428728f0dbe2a316a1890a98c641c83bf3750da51776a410587177b466015b69af5f9d464b5348ddf635fd08be7f963843d1bc5bd0001",
        "0e2be32a94060c40104d1539222ecee8499dd3bab236896bb5299b088474c21d1fd1cb558cd76372656ad10d5f08e3aadd405764b835f4e47b6d45cd093e0fdc",
        "6a1d8e089f76c3defa32efc9a7b1d1dfa5f9e9b42bec0986e9d7234cf70aacffc1bec101160b88dabd728e8329f2665c7bcb068f16b7c0ff684f960cfcdd80c7",
        "b148436d8f4f44f478750fc6eef32de8dbb6e036d8d56d63be4c79fb5576d458e60ad2452f3a9eb2d58b85d0c5894a7c2bb1becc71e064f875d398c73a2ac021",
        "7b30f406b2f4ea2c3e21ec69fe6d2a5a06413b26710cb83193dd88c666549f7b4fd66596ba484f4045d4e2d56337b1fd37286864530c16f5d428113ec4befe97",
        "00d186594931e10b95730f99768e85495f4a38a6fb1ac2fd43ddc822d5169f886d8f7451c25ffd2b7b6d1cc744ed88ce46770a49e988a8506615207ccd74c2c6",
        "61c9a5db3d132872ce1443910df7a9a96309feb434634753cccf389d0106ed1df4a27fdb67f0d14700953bcb4d5eca2658978f770e6facd1b818291f1c4f21cb",
        "d766520af89cbb32b57e2a42262a6a8fc85d2ece1a0fbfeb56073f7fe6d55aec28848f4dc3f57a218499304dc2bb7b47ff77311cbc6e409d9c5e14e599b31896",
        "c7a7d74519861d4aefd4a30892268486bdf0b57f6f6e0b1ad2fb5b1aade8e71e5cbc261a38fedf835aefb12acf54882dd961dae357da33bfdd7c44cff45f8e22",
        "ca360b895f7bcd43104ba6b5d051adba06805bec7a5c26c3b0c61997fb23e31069eda53fc340862523f75a53a12324610e8ffa5df26b477218bdd2b35a3816ca",
        "bb36396f9365c50c865196229b83de7d05a1d0b4ecd4ac3c7885c6cc6453f9b6fc3a03af966e11e20727d8309d4e5925d990857b09cc71f6f3ac21bba48fc04b",
        "7471a81c3b7304452f7c61893c411dc03d4db15ac3283c06dcff0baca78dd0617e67dc49290fdd61d2d2954abe956783db7a293f9cb1be562b756cd41068f49a",
        "51992585db150c3bafd8b655c29157ab2658151ab68502a12053a61883a848b5bb680c6c6148668c657c1f2bded7390a22e3c34b1e8a7b73cf91c5aa7eae724a",
        "4cbee0df1ce7310e97958682e6fa443b1a674b713f10d178afc5dbeedecbff0ba228ac1bafa90f86e55a5646656b6aea00f4c239a1ff8e09d05502d3e16a6822",
        "5b6c1c0ddb978450c2d259f78bdc8fc3cb1038b270e2860b8d6e7c406c7cedfef8a5fd93b502a5e1deff8f7f942053d6eee3f6cf9c9efd6ce3b24635c4a4323d",
        "b3c72998f26b3c552f7b7207ee18cc287165a2cf548f3cb5f39974d6aeec189d3617a9c45dd409dbc661c700ddb705c9a13a86543cb44e6e9af2a6f2d49ed271",
        "964fd050fdb2d43f27a1c115b3039c38ba9f043fe0604c0a3f4bbbc5f21231ce4442f8e2ce48a3f09f81257c5188f25d7afed12cd3e546d757745851dcb30f24",
        "4430e25cf57a0e7ebf694e14e4dfccc4c443fdb788407b0ae98b290da020013b002480ba72b5e9727cd1a0c82df8b54db8a8ba041d9dc99a50e8cd140334166f",
        "5adfef42651dcc0f4ef3187fad8d42b85b2ef8599b500efd804e6aaa03759afff64334fbc45500fcfea27b922f7941931c7aefc718d10df460f7816b0a629cfb",
        "12f0be0fe9599e9a7c574d1d29779134e82c759e75c2674c981dbc1856f4ba10ce908a1d3f603edbccc6509c8c3099a216ee940ce681169a16866c6c07ce8cd7",
        "a63e5521557642f2cf1134c06d398f8960a3e6a0d9d501c86e97b9de23fc95af472735c61c48b0d376bb8b3aa265f31ee0c53d2f7fdec1e72457f94ff0ebb81f",
        "01bb5e586181b9350994b3237fe9879cb06edbf1e7217389deeb11efbe209127d7f882264c5ce1811e57d8629fceec47a052b3afdb7887489fd104c9b7a77a17",
        "730fcf1abba68318af7347d14c0a5ea9a3e994d7e46d4915a1d51015e49f479f1b0d2624cee7ca8349af280ec3353bf3a2c3ece7431490662ff5047c4009fad4",
        "89a3207537afa5cd194c11a0d7a08eddb8a73b0515e4c262422d5018d5dc706f6fac771e209e9cd776370b4a0dfe6e9b085e4378c74e6107c03a8fdf5ea745e9",
        "2bdd6ceee1f4c7941d2a6f1dac0c7761be6f56233d01eb4639713c841d1a6640d8bcbadeeb0284dceca2938effe3831d8db31824d023ef2566f60226df88328a",
        "fb3c6fdabd3ffa292192f75ccb11c0d9e9315c5205ce2afff7aeb627507443d3270687a50a164f21367db84557c67c4c1353227db4fa179e1f8d7ce325565fd9",
        "7b186e6f6a5bc58487c491b08f5b9d9e2b8ab7bb2b618a99b8c8ef8091677d613dce354c35ba3b557813c485f3fd61a42c67fd1703a8d4d3bf5a564a9634c67c",
        "aab550398016a605ae805bbb51369fb0d71abce911a26ecf25588c516139397dc2046f3aa55d64eddc4e928915221eaa517882bc3eed340f7f9e14b49226a9c9",
        "f0267633892750b2ce6a9ab6f63c5143d94d12e667a04ae5a39d139ac4a5e61d55a9a70aa180ba09e59aea46ecf0a91f0bb28df6bfe9b611296d81fa80acb234",
        "8ce7ea067cefe665b9bbfb451c751eb7d884f3a967b5f367e90a1a750e645e58373b6eb04fb66186ca0df682ee953cfca33dd83048ad5d9efcb73d121602c424",
        "29c1cb3e1c230a6b9c7464067721c6bbfd7c648d137457317a5293afc4fec5b2a7364f171a752c72ed0c890255b18ba9cd92fc174a1787a4a59850c83d6d1bc1",
        "1960134c0003e259b0b5ea57ad784a9c4073619f220c7d4aad1e22a6e284b86e8e8409a0f37806123bf6a3ed4841bf3740e62a1e55bcde18c17f167a29624301",
        "5ab81bcac1d889b449091bbff1926546fd992abeb82f7b9d9a3c8f4ef0290e94090e3135c517a82dade484ff3c7c5615f5c6445127e76e1f982fb8d3fd2aac1c",
        "25031c7dfbd663190db7411f7802ad1055030c7ff2d4381847b55a3fa61dddcdff330b5918e44a95ad659b46907be19e3e8bd7581fa00f11d61d243bc6845d98",
        "8a17b27763782d50d676dbbf3f13f4592b25fae6e922e2e7dac06f62aff69841b97e3b0191aa45c2d635bc173a204751f89fd30b553f98c4104ead9873f126f5",
        "250f2211c207cf08e26d97fd495dc0ba97588cf65aad13aef2747bf874d8c5d3694c5fef3c88a4a7b79e50f956a55ac3b38cfa9bc2e38902440961627f458af8",
        "158ed59115351fcd80a8c2e627559947bf445752d610564db4c78436447cd01981e25caeec4c17ced51306a558120a8dad55877efe12f26a13022351d60acb9c",
        "92703179601dcf75ff9dca10626c732ff021982c370a6eab25271926c96dc253fd74c0de17c2ac6af2ee31898f36a17b8568186cbab5304a36f0a08b2c760a14",
        "0266347fc3e628d9fb569884e5bf638826af3d269da31f99c3d2a03a45ad0737735bedc334e11c6b2cf0dbd41bfc6bdf44f1c0de9b3ae33670dada449095956e",
        "761ed4d0c847b29d3c61544bae4a687b52099cf9585f547ea2d326fe24d8b90396856dfd98ed92c4ccdb1478b9b822cf02f80ed32effaf463caf187656f67ed4",
        "0232843c464d3b03ad74a8860535289bbb3b1611344c61d4c84cc50e0b6a78a9cb8055f12d84f8618dfa90b19974871f59c8d78a84918563e90af82a4741a126",
        "5eaac49189233e55a6ed0fd9f517d6d7a758e64c8a838a2664049734e37dceee32d093cea0b9a7c92d44fb852c38405998fe6bc8502d303f571fa1ab46397a15",
        "f209e18c5ee482aa8af7f387e15ca0f5d88355b6792068c3c24f0fefd20e2c92194281935e0210643e5e18014021d11a74b1933b0a2bf63440c82596301110c9"
    };

    const std::string m_7000 =
        "1008e9a4a102ffbebb6e6cbf6f36ba0778912d63ad966740b56e50fdb8fe12280f3f31a3ac22c2ff4a8f0c00a06e56092f26715649d752de7624a95b118f61eb";
};

TEST_F(Blake2bKeyedTests, Simple) {
    EXPECT_NO_THROW(m_hfun.finalize());
    EXPECT_EQ(m_hfun.hexdigest(), m_empty_digest);
}

TEST_F(Blake2bKeyedTests, ResetWorks) {
    EXPECT_NO_THROW(m_hfun.update("Hello", 5));
    EXPECT_NO_THROW(m_hfun.reset());
    EXPECT_NO_THROW(m_hfun.set_key(m_key.c_str(), m_key.length()));
    EXPECT_NO_THROW(m_hfun.finalize());
    EXPECT_EQ(m_hfun.hexdigest(), m_empty_digest);
}

TEST_F(Blake2bKeyedTests, BasicInput) {
    EXPECT_NO_THROW(m_hfun.update("The quick brown fox jumps over the lazy dog", 43));
    EXPECT_NO_THROW(m_hfun.finalize());
    EXPECT_EQ(m_hfun.hexdigest(), m_fox_digest);
}

TEST_F(Blake2bKeyedTests, ChoppedInput) {
    EXPECT_NO_THROW(m_hfun.update("The quick brown fox ", 20));
    EXPECT_NO_THROW(m_hfun.update("jumps o", 7));
    EXPECT_NO_THROW(m_hfun.update("ver the la", 10));
    EXPECT_NO_THROW(m_hfun.update("zy dog", 6));
    EXPECT_NO_THROW(m_hfun.finalize());
    EXPECT_EQ(m_hfun.hexdigest(), m_fox_digest);
}

TEST_F(Blake2bKeyedTests, Extensive) {
    int i, j;
    for (i = 0; i < m_cmp.size(); i++) {
        EXPECT_NO_THROW(m_hfun.reset());
        EXPECT_NO_THROW(m_hfun.set_key(m_key.c_str(), m_key.length()));
        for (j = 0; j < i; j++)
            EXPECT_NO_THROW(m_hfun.update("A", 1));
        EXPECT_NO_THROW(m_hfun.finalize());
        EXPECT_EQ(m_hfun.hexdigest(), m_cmp.at(i));
    }
}

TEST_F(Blake2bKeyedTests, SevenThousandAs) {
    int i;
    for (i = 0; i < 1000; i++)
        EXPECT_NO_THROW(m_hfun.update("AAAAAAA", 7));
    EXPECT_NO_THROW(m_hfun.finalize());
    EXPECT_EQ(m_hfun.hexdigest(), m_7000);
}

TEST_F(Blake2bKeyedTests, UpdateAfterFinal) {
    EXPECT_NO_THROW(m_hfun.finalize());
    EXPECT_THROW(m_hfun.update("Hello", 5), std::invalid_argument);
}

TEST_F(Blake2bKeyedTests, DigestBeforeFinal) {
    EXPECT_THROW(m_hfun.hexdigest(), std::invalid_argument);
    EXPECT_NO_THROW(m_hfun.reset());

    EXPECT_NO_THROW(m_hfun.update("Hello", 5));
    EXPECT_THROW(m_hfun.hexdigest(), std::invalid_argument);
}
